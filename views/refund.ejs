<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Refund Calculation</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* Navbar */
      .custom-navbar {
        background-color: #ffffff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 12px 0;
      }

      .custom-navbar .navbar-brand {
        color: #0056b3 !important;
        font-weight: 600;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
      }

      .custom-navbar .navbar-brand img {
        height: 60px;
        margin-right: 8px;
      }

      .custom-navbar .navbar-nav .nav-link {
        color: #0056b3 !important;
        font-weight: 500;
        transition: all 0.4s ease;
        padding: 8px 15px;
        margin: 0 5px;
      }

      .custom-navbar .navbar-nav .nav-link:hover {
        color: #ffffff !important;
        background-color: #007bff;
        border-radius: 5px;
      }

      @media (max-width: 600px) {
        .custom-navbar .navbar-nav .nav-link {
          padding: 10px;
          margin: 0;
        }

        .custom-navbar .navbar-brand img {
          height: 24px;
        }
      }

      /* Base styling */
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        margin: 0;
        padding: 40px;
        padding-top: 100px; /* Adjusted for fixed navbar */
        background: #e6f0fa;
        color: #1a1a1a;
      }

      h1 {
        text-align: left;
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 20px;
        color: #2c5282;
      }

      form {
        max-width: 600px;
        margin: auto;
        background: #ffffff;
        padding: 24px;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        border-left: 4px solid #4299e1;
      }

      label {
        display: block;
        margin-top: 16px;
        font-size: 14px;
        font-weight: 500;
        color: #2d3748;
      }

      select,
      textarea {
        width: 100%;
        padding: 8px 12px;
        margin-top: 6px;
        border-radius: 6px;
        border: 1px solid #d1d5db;
        font-size: 14px;
        background-color: #f7fafc;
        transition: border-color 0.2s ease;
        box-sizing: border-box;
        appearance: none;
        background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%232d3748%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
        background-repeat: no-repeat;
        background-position: right 8px top 50%;
        background-size: 12px auto;
      }

      select:focus,
      textarea:focus {
        outline: none;
        border-color: #4299e1;
        box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.2);
      }

      textarea {
        resize: vertical;
        min-height: 80px;
      }

      /* Toggle switch */
      .toggle-container {
        display: flex;
        align-items: center;
        margin-top: 6px;
      }

      .toggle-label {
        font-size: 14px;
        font-weight: 500;
        color: #2d3748;
        margin-right: 12px;
      }

      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 20px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #e2e8f0;
        transition: 0.4s;
        border-radius: 20px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: #68d391;
      }

      input:checked + .slider:before {
        transform: translateX(20px);
      }

      /* Buttons */
      .button-container {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
        margin-top: 24px;
      }

      button {
        padding: 8px 16px;
        font-size: 14px;
        font-weight: 500;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      button[type="reset"] {
        background-color: #edf2f7;
        color: #4a5568;
      }

      button[type="reset"]:hover {
        background-color: #e2e8f0;
      }

      button[type="submit"] {
        background-color: #4299e1;
        color: white;
      }

      button[type="submit"]:hover {
        background-color: #3182ce;
      }

      /* Static JSON display */
      .static-json {
        margin-top: 10px;
        font-size: 12px;
        background-color: #f1f5f9;
        padding: 10px;
        border: 1px dashed #cbd5e0;
        border-radius: 6px;
        white-space: pre-wrap;
        word-break: break-word;
      }

      details summary {
        cursor: pointer;
        margin-top: 10px;
        font-weight: 500;
        color: #2c5282;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-content {
        background-color: #ffffff;
        padding: 24px;
        border-radius: 8px;
        border-left: 4px solid #68d391;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        width: 90%;
        position: relative;
      }

      .modal-content.error {
        border-left: 4px solid #f56565;
      }

      .modal-content h2,
      .modal-content h3 {
        margin: 0 0 16px;
        font-size: 16px;
        font-weight: 500;
      }

      .modal-content h2 {
        color: #2f855a;
      }

      .modal-content h3 {
        color: #9b2c2c;
      }
      .brand-logo {
        height: 100%;
        width: auto;
        max-width: 100%;
        object-fit: contain;
      }

      .modal-content pre {
        background-color: #f1f5f9;
        padding: 12px;
        border-radius: 6px;
        font-family: "Courier New", Courier, monospace;
        font-size: 14px;
        white-space: pre-wrap;
        word-break: break-word;
        max-height: 300px;
        overflow-y: auto;
      }

      .close-btn {
        position: absolute;
        top: 12px;
        right: 12px;
        background: #edf2f7;
        color: #4a5568;
        border: none;
        border-radius: 4px;
        padding: 4px 8px;
        cursor: pointer;
        font-size: 14px;
      }

      .close-btn:hover {
        background-color: #e2e8f0;
      }
    </style>
  </head>
  <body>
    <nav class="custom-navbar navbar navbar-expand-lg fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">
          <img
            src="https://ondc.org/assets/ondc-buyer-apps/images/digihaat.png"
            class="brand-logo"
          />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarNav"
        >
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="/isCancellable">Cancel Request</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/refund">Refund Request</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/eta-check">ETA-Breached</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <h1>Check Your Refund Amount</h1>
    <form action="/refund" method="POST">
      <label
        >Actor *
        <select name="actor" required>
          <option value="">Select...</option>
          <option value="Buyer">Buyer</option>
          <option value="Seller">Seller</option>
        </select>
      </label>

      <label
        >Action Type *
        <select name="actionType" required>
          <option value="">Select...</option>
          <option value="full">Full</option>
          <option value="partial">Partial</option>
        </select>
      </label>

      <label
        >Action *
        <select name="action" required>
          <option value="">Select...</option>
          <option value="return">Return</option>
          <option value="cancellation">Cancellation</option>
        </select>
      </label>

      <label
        >Is ETA Breached *
        <div class="toggle-container">
          <span class="toggle-label">False</span>
          <label class="toggle-switch">
            <input type="checkbox" name="isETABreached" value="true" />
            <span class="slider"></span>
          </label>
          <span class="toggle-label">True</span>
        </div>
      </label>

      <label
        >Charge Payload (JSON) *
        <textarea
          name="charge"
          rows="6"
          placeholder="Paste or edit your JSON here..."
        >
{
        "transactionId": "2d074a8b-568d-447c-a394-e49f9cc42406",
        "__v": 0,
        "createdAt": {
          "$date": "2025-04-29T07:58:55.915Z"
        },
        "history": [],
        "quote": {
          "itemsList": [
            {
              "itemId": "66bc5faf91c33645fda23b36",
              "name": "Cheese Chaska",
              "sellerPrice": 278.25,
              "price": 278.25,
              "tax": 13.25,
              "sellerDiscount": 0,
              "basePriceWithoutTax": 265,
              "quantity": 1,
              "parentItemId": null,
              "basePrice": 278.25,
              "discountedBasePrice": 278.25
            },
            {
              "itemId": "66bc5faf91c33645fda23b63",
              "name": "Cheese Maska",
              "sellerPrice": 478.25,
              "price": 478.25,
              "tax": 13.25,
              "sellerDiscount": 0,
              "basePriceWithoutTax": 465,
              "quantity": 2,
              "parentItemId": null,
              "basePrice": 478.25,
              "discountedBasePrice": 478.25
            }
          ],
          "subsidyCriteriaCharge": null,
          "distance": null,
          "distanceType": "KM",
          "platformFees": 2.54,
          "subsidyCapping": null,
          "transactionId": null,
          "totalOrderValue": "1280.25",
          "itemCost": 265,
          "taxes": {
            "itemTaxes": 13.25,
            "platformFeesTax": 0.46
          },
          "sellerFees": {
            "miscCharge": 0,
            "packingCharge": 0,
            "sellerDiscount": 0
          },
          "totalOrderValueAfterSubsidy": 1300.25,
          "deliveryItemList": [
            {
              "baseCharge": 70,
              "fulfillmentId": "WSD111",
              "deliveryCharge": 70,
              "digiHaatSubsidy": 0,
              "snpDiscount": 0
            }
          ],
          "combinedDeliveryItemList": {
            "baseCharge": 70,
            "fulfillmentId": "WSD111",
            "deliveryCharge": 70,
            "digiHaatSubsidy": 0,
            "snpDiscount": 0
          },
          "offer": {},
          "applySubsidy": false,
          "subsidyCriteriaDistance": null,
          "totalOrderValueAfterSubsidyBeforeCoupon": 1300.25,
          "subsidy": 0,
          "mov": 500.25,
          "ONDC_FA": 0,
          "totalProductDiscount": 0
        },
        "updatedAt": {
          "$date": "2025-04-29T07:58:55.915Z"
        }
      }</textarea
        >
      </label>

      <label
        >on_cancelPayload (JSON) *
        <textarea
          name="on_cancelPayload"
          rows="20"
          placeholder="Paste or edit your JSON here..."
        >
        {
          "context": {
            "domain": "ONDC:RET10",
            "action": "on_cancel",
            "core_version": "1.2.0",
            "bap_id": "witslab-bap-preprod.thewitslab.com",
            "bap_uri": "https://witslab-bap-preprod.thewitslab.com/api/v2",
            "bpp_id": "ondc-api.kiko.live/ondc-seller-v2",
            "bpp_uri": "https://ondc-api.kiko.live/ondc-seller-v2",
            "transaction_id": "76de69b5-d38d-4def-a860-cd6da66f87e8",
            "message_id": "def4863a-2848-4df2-80df-4b3f06bd6cb9",
            "city": "std:022",
            "country": "IND",
            "timestamp": "2024-08-22T16:46:06.662Z",
            "ttl": "PT30S"
          },
          "message": {
            "order": {
              "id": "bf3c8f58-2baf-4921-ba48-3733a6f9fd65",
              "state": "Cancelled",
              "provider": {
                "id": "66c58cf1f7305b72e2d40f3c",
                "locations": [
                  {
                    "id": "location-66c58cf1f7305b72e2d40f3c"
                  }
                ]
              },
              "items": [
                {
                  "quantity": {
                    "count": 0
                  },
                  "id": "66bc5faf91c33645fda23b36",
                  "fulfillment_id": "fulfillment-66c58cf1f7305b72e2d40f3c"
                },
                {
                  "quantity": {
                    "count": 1
                  },
                  "id": "66bc5faf91c33645fda23b36",
                  "fulfillment_id": "fulfillment-66c58cf1f7305b72e2d40f3c-RTO"
                },
                {
                  "quantity": {
                    "count": 1
                  },
                  "id": "66bc5faf91c33645fda23b63",
                  "fulfillment_id": "fulfillment-66c58cf1f7305b72e2d40f3d"
                },
                {
                  "quantity": {
                    "count": 1
                  },
                  "id": "66bc5faf91c33645fda23b63",
                  "fulfillment_id": "fulfillment-66c58cf1f7305b72e2d40f3d-RTO"
                }
              ],
              "billing": {
                "address": {
                  "building": "Sri Sri Maddaruma",
                  "city": "Mumbai",
                  "state": "Maharashtra",
                  "country": "IND",
                  "area_code": "400080",
                  "locality": "Mulund Railway Station Road",
                  "name": "Witslab Testing"
                },
                "phone": "8888228822",
                "name": "Witslab Testing",
                "email": "test@witslab.com",
                "created_at": "2024-08-22T16:45:05.261Z",
                "updated_at": "2024-08-22T16:45:05.261Z"
              },
              "fulfillments": [
                {
                  "id": "fulfillment-66c58cf1f7305b72e2d40f3c",
                  "@ondc/org/provider_name": "Vijendra Grocery Store",
                  "state": {
                    "descriptor": {
                      "code": "Cancelled"
                    }
                  },
                  "type": "Delivery",
                  "tracking": false,
                  "start": {
                    "location": {
                      "id": "location-66c58cf1f7305b72e2d40f3c",
                      "gps": "12.982017,77.587606",
                      "descriptor": {
                        "name": "Vijendra Grocery Store"
                      },
                      "address": {
                        "locality": "H-123, Surya Shop",
                        "city": "Bangalore",
                        "area_code": "560001",
                        "state": "Karnataka"
                      }
                    },
                    "time": {
                      "range": {
                        "start": "2024-08-22T16:45:25.655Z",
                        "end": "2024-08-23T10:45:25.655Z"
                      },
                      "timestamp": "2024-08-22T16:45:54.635Z"
                    },
                    "contact": {
                      "phone": "9009120913",
                      "email": "vijendra@linkites.com"
                    }
                  },
                  "end": {
                    "location": {
                      "gps": "19.170292,72.953446",
                      "address": {
                        "name": "Witslab Testing",
                        "building": "Sri Sri Maddaruma",
                        "locality": "Mulund Railway Station Road",
                        "city": "Mumbai",
                        "state": "Maharashtra",
                        "country": "IND",
                        "area_code": "400080"
                      }
                    },
                    "time": {
                      "range": {
                        "start": "2024-08-23T10:45:25.655Z",
                        "end": "2024-08-23T16:45:25.655Z"
                      }
                    },
                    "person": {
                      "name": "Witslab Testing"
                    },
                    "contact": {
                      "phone": "8888228822",
                      "email": "test@witslab.com"
                    }
                  },
                  "@ondc/org/TAT": "P7D",
                  "tags": [
                    {
                      "code": "cancel_request",
                      "list": [
                        {
                          "code": "retry_count",
                          "value": "3"
                        },
                        {
                          "code": "rto_id",
                          "value": "fulfillment-66c58cf1f7305b72e2d40f3c-RTO"
                        },
                        {
                          "code": "reason_id",
                          "value": "014"
                        },
                        {
                          "code": "initiated_by",
                          "value": "ondc-api.kiko.live/ondc-seller-v2"
                        }
                      ]
                    },
                    {
                      "code": "precancel_state",
                      "list": [
                        {
                          "code": "fulfillment_state",
                          "value": "Out-for-delivery"
                        },
                        {
                          "code": "updated_at",
                          "value": "2024-08-22T16:46:06.662Z"
                        }
                      ]
                    }
                  ]
                },
                {
                  "id": "fulfillment-66c58cf1f7305b72e2d40f3c-RTO",
                  "type": "RTO",
                  "state": {
                    "descriptor": {
                      "code": "RTO-Initiated"
                    }
                  },
                  "start": {
                    "time": {
                      "timestamp": "2024-08-22T16:46:06.662Z"
                    },
                    "location": {
                      "gps": "19.170292,72.953446",
                      "address": {
                        "name": "Witslab Testing",
                        "building": "Sri Sri Maddaruma",
                        "locality": "Mulund Railway Station Road",
                        "city": "Mumbai",
                        "state": "Maharashtra",
                        "country": "IND",
                        "area_code": "400080"
                      }
                    }
                  },
                  "end": {
                    "location": {
                      "id": "location-66c58cf1f7305b72e2d40f3c",
                      "gps": "12.982017,77.587606",
                      "descriptor": {
                        "name": "Vijendra Grocery Store"
                      },
                      "address": {
                        "locality": "H-123, Surya Shop",
                        "city": "Bangalore",
                        "area_code": "560001",
                        "state": "Karnataka"
                      }
                    }
                  },
                  "tags": [
                    {
                      "code": "quote_trail",
                      "list": [
                        {
                          "code": "type",
                          "value": "item"
                        },
                        {
                          "code": "id",
                          "value": "66bc5faf91c33645fda23b36"
                        },
                        {
                          "code": "currency",
                          "value": "INR"
                        },
                        {
                          "code": "value",
                          "value": "-440"
                        }
                      ]
                    }
                  ]
                }
              ],
              "quote": {
                "price": {
                  "currency": "INR",
                  "value": "3"
                },
                "breakup": [
                  {
                    "@ondc/org/item_id": "66bc5faf91c33645fda23b36",
                    "@ondc/org/item_quantity": {
                      "count": 0
                    },
                    "title": "Johnson's Baby No More Tears Baby Shampoo, 200 Ml",
                    "@ondc/org/title_type": "item",
                    "price": {
                      "currency": "INR",
                      "value": "0"
                    },
                    "item": {
                      "price": {
                        "currency": "INR",
                        "value": "220"
                      }
                    }
                  },
                  {
                    "@ondc/org/item_id": "fulfillment-66c58cf1f7305b72e2d40f3c",
                    "title": "Delivery charges",
                    "@ondc/org/title_type": "delivery",
                    "price": {
                      "currency": "INR",
                      "value": "0.00"
                    }
                  },
                  {
                    "@ondc/org/item_id": "fulfillment-66c58cf1f7305b72e2d40f3c",
                    "title": "Convenience Fee",
                    "@ondc/org/title_type": "misc",
                    "price": {
                      "currency": "INR",
                      "value": "3.00"
                    }
                  }
                ],
                "ttl": "P1D"
              },
              "payment": {
                "params": {
                  "amount": "443.00",
                  "currency": "INR",
                  "transaction_id": "order_Oo11o21ifieg45"
                },
                "status": "PAID",
                "type": "ON-ORDER",
                "collected_by": "BAP",
                "@ondc/org/buyer_app_finder_fee_type": "percent",
                "@ondc/org/buyer_app_finder_fee_amount": "3.0",
                "@ondc/org/settlement_basis": "delivery",
                "@ondc/org/settlement_window": "P7D",
                "@ondc/org/withholding_amount": "0.00",
                "@ondc/org/settlement_details": [
                  {
                    "settlement_counterparty": "seller-app",
                    "upi_address": "",
                    "beneficiary_name": "SMOOTH TAG TECHNOLOGIES PRIVATE LIMITED",
                    "settlement_type": "neft",
                    "settlement_bank_account_no": "50200057222741",
                    "settlement_ifsc_code": "HDFC0000015",
                    "settlement_phase": "sale-amount",
                    "bank_name": "HDFC BANK LTD ",
                    "branch_name": "MUMBAI - MULUND WEST (WEST)"
                  }
                ]
              },
              "created_at": "2024-08-22T16:45:25.551Z",
              "updated_at": "2024-08-22T16:46:06.662Z"
            }
          }
        }
      </textarea
        >
      </label>

      <div class="button-container">
        <button type="reset">Reset</button>
        <button type="submit">Calculate Refund</button>
      </div>
    </form>

    <!-- Modal for Result -->
    <% if (typeof refundResult !== 'undefined') { %>
    <div class="modal" id="resultModal" style="display: flex">
      <div class="modal-content">
        <button class="close-btn" onclick="closeModal()">Close</button>
        <h2>Refund Details</h2>
        <pre id="refundResult">
<%- JSON.stringify(refundResult, null, 2) %></pre
        >
      </div>
    </div>
    <% } %> <% if (typeof error !== 'undefined') { %>
    <div class="modal" id="errorModal" style="display: flex">
      <div class="modal-content error">
        <button class="close-btn" onclick="closeModal()">Close</button>
        <h3>Error: <%= error %></h3>
      </div>
    </div>
    <% } %>

    <script>
      function closeModal() {
        document.querySelectorAll(".modal").forEach((modal) => {
          modal.style.display = "none";
        });
      }

      window.onclick = function (event) {
        document.querySelectorAll(".modal").forEach((modal) => {
          if (event.target === modal) {
            modal.style.display = "none";
          }
        });
      };
    </script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
